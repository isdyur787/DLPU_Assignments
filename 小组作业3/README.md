# 递归下降语法分析器

## 项目简介

这是一个基于递归下降分析方法的语法分析程序，实现了对算术表达式和赋值语句的词法分析和语法分析功能。该项目包含：

- **词法分析器**：将输入字符串转换为 Token 序列
- **递归下降语法分析器**：对 Token 序列进行语法分析
- **左递归检测和消除**：自动检测文法中的左递归并进行消除
- **可视化图形界面**：提供友好的用户交互界面
- **文件读取功能**：支持从文件加载输入

## 文法定义

本项目使用的是消除左递归后的算术表达式文法：

```
Program   -> Statement END
Statement -> ID ASSIGN Expr | Expr
Expr      -> Term Expr'
Expr'     -> PLUS Term Expr' | MINUS Term Expr' | ε
Term      -> Factor Term'
Term'     -> MULT Factor Term' | DIV Factor Term' | ε
Factor    -> LPAREN Expr RPAREN | ID | NUM
```

### 终结符说明

- `ID`: 标识符（字母或下划线开头，后接字母、数字或下划线）
- `NUM`: 数字（整数或小数）
- `ASSIGN`: 赋值符号 `=`
- `PLUS/MINUS/MULT/DIV`: 运算符 `+` `-` `*` `/`
- `LPAREN/RPAREN`: 括号 `(` `)`
- `END`: 结束符 `#`

## 项目结构

```
小组作业3/
├── lexer.py              # 词法分析器（230行）
├── parser.py             # 递归下降语法分析器（281行）
├── gui.py                # 图形用户界面（520行）
├── grammar_analyzer.py   # 文法分析器（左递归检测和消除）
├── test_left_recursion.py # 左递归功能测试脚本
├── demo_left_recursion.py # 左递归功能演示脚本
├── test_input1.txt       # 测试用例1：简单表达式
├── test_input2.txt       # 测试用例2：复杂赋值
├── test_input3.txt       # 测试用例3：错误示例
├── test_input4.txt       # 测试用例4：带括号
├── test_input5.txt       # 测试用例5：小数运算
├── run.sh                # Linux/macOS 启动脚本
├── run.bat               # Windows 启动脚本
├── README.md             # 项目说明（本文件）
├── 项目总结.md           # 项目总结报告（745行）
└── 流程图.md         # 系统流程图（478行，15个流程图）
```

**代码总计**: 约 860 行 Python 代码  
**文档总计**: 1508 行文档（3 个 Markdown 文件）  
**文件总数**: 13 个核心文件

## 运行环境

- Python 3.6 或更高版本
- tkinter（Python 自带，无需额外安装）

## 使用方法

### 方法 1：运行图形界面（推荐）

```bash
python3 gui.py
```

或者双击运行脚本：

- macOS/Linux: `./run.sh`
- Windows: `run.bat`

启动后会出现图形界面，包含以下功能：

1. **文法定义区**：显示当前使用的文法规则（黑色背景，绿色文字）
2. **输入区**：
   - 手动输入要分析的字符串（必须以 `#` 结束）
   - 点击"从文件加载"按钮从文件读取输入
   - 点击"加载示例"按钮选择预设示例
   - 点击"清空"按钮清除输入和输出
3. **分析结果区**（多标签页）：
   - **Token 序列**：显示词法分析结果
   - **分析过程**：显示详细的语法分析步骤
   - **错误信息**：如果有错误，显示错误类型和位置

### 方法 2：命令行测试

测试词法分析器：

```bash
python3 lexer.py
```

测试语法分析器：

```bash
python3 parser.py
```

测试左递归检测和消除功能：

```bash
python3 test_left_recursion.py
```

演示左递归功能：

```bash
python3 demo_left_recursion.py
```

## 左递归检测和消除功能

### 功能概述

新增的左递归检测和消除功能可以帮助用户：

1. **检测文法中的左递归**：自动识别直接左递归和间接左递归
2. **消除左递归**：将左递归文法转换为等价的右递归文法
3. **验证消除结果**：确保消除后的文法不再包含左递归
4. **可视化展示**：清晰显示原始文法和消除后的文法对比

### 使用方法

1. **启动图形界面**：

   ```bash
   python3 gui.py
   ```

2. **切换到"文法分析"标签页**

3. **输入文法**：

   - 手动输入文法规则
   - 或点击"加载文法示例"选择预设示例

4. **分析文法**：
   - 点击"分析文法"按钮
   - 系统会自动检测左递归并显示结果

### 文法输入格式

支持标准的 BNF 文法格式：

```
非终结符 -> 产生式1 | 产生式2 | 产生式3
```

示例：

```
E -> E + T | T
T -> T * F | F
F -> ( E ) | id
```

### 功能特点

- **直接左递归检测**：识别形如 `A -> A α` 的产生式
- **间接左递归检测**：使用深度优先搜索检测间接左递归
- **标准消除算法**：使用经典的左递归消除算法
- **结果验证**：自动验证消除后的文法
- **详细报告**：显示检测过程和消除步骤

### 示例演示

**原始文法（含左递归）**：

```
E -> E + T | T
T -> T * F | F
F -> ( E ) | id
```

**消除左递归后**：

```
E -> T E'
E' -> + T E' | ε
T -> F T'
T' -> * F T' | ε
F -> ( E ) | id
```

## 输入示例

### 正确示例

```
a+b*c#
```

```
(a+b)*c#
```

```
x=3+5*2#
```

```
(a+b)*(c-d)#
```

```
result = (num1 + num2) * num3 / num4#
```

### 错误示例

```
a+b*#
```

错误原因：缺少操作数

```
a+b
```

错误原因：缺少结束符 `#`

```
(a+b#
```

错误原因：括号不匹配

## 输出说明

### 成功分析

当输入串符合文法规则时，程序会：

1. 显示状态：**✓ 分析成功：ACC**
2. 输出 Token 序列
3. 输出完整的分析过程（包括每一步应用的产生式）

### 失败分析

当输入串不符合文法规则时，程序会：

1. 显示状态：**✗ 分析失败：ERROR**
2. 输出已识别的 Token 序列
3. 输出分析过程（到出错位置为止）
4. 在错误信息标签页显示：
   - 错误类型
   - 错误位置
   - 期望的符号
   - 实际遇到的符号

## 分析过程示例

输入：`a+b*c#`

```
开始语法分析
应用产生式: Program -> Statement END
进入 Statement
应用产生式: Statement -> Expr
进入 Expr
应用产生式: Expr -> Term Expr'
进入 Term
应用产生式: Term -> Factor Term'
进入 Factor
应用产生式: Factor -> ID
匹配 ID: 'a'
退出 Factor
进入 Term'
应用产生式: Term' -> ε
退出 Term'
退出 Term
进入 Expr'
应用产生式: Expr' -> PLUS Term Expr'
匹配 PLUS: '+'
进入 Term
应用产生式: Term -> Factor Term'
进入 Factor
应用产生式: Factor -> ID
匹配 ID: 'b'
退出 Factor
进入 Term'
应用产生式: Term' -> MULT Factor Term'
匹配 MULT: '*'
进入 Factor
应用产生式: Factor -> ID
匹配 ID: 'c'
退出 Factor
进入 Term'
应用产生式: Term' -> ε
退出 Term'
退出 Term
进入 Expr'
应用产生式: Expr' -> ε
退出 Expr'
退出 Expr
退出 Statement
匹配 END: '#'
✓ 语法分析成功！
```

## 技术特点

1. **词法分析**

   - 支持标识符、数字（整数和小数）
   - 支持运算符：`+` `-` `*` `/` `=`
   - 支持括号：`(` `)`
   - 支持注释：`//` 和 `/* */`
   - 自动跳过空白字符

2. **语法分析**

   - 采用递归下降分析方法
   - 消除了左递归
   - 详细记录每一步分析过程
   - 准确定位语法错误位置

3. **用户界面**
   - 直观的图形界面
   - 多标签页展示不同信息
   - 支持文件读取
   - 内置示例快速测试

## 常见问题

**Q: 为什么必须以 # 结束？**  
A: `#` 是文法规定的结束符，用于标识输入串的结束，这是编译原理中的常见约定。

**Q: 支持哪些运算？**  
A: 目前支持加法(`+`)、减法(`-`)、乘法(`*`)、除法(`/`)和赋值(`=`)运算。

**Q: 可以使用小数吗？**  
A: 可以，词法分析器支持整数和小数。

**Q: 标识符有什么要求？**  
A: 标识符必须以字母或下划线开头，后面可以跟字母、数字或下划线。

**Q: 运算符优先级如何？**  
A: 乘法和除法优先级高于加法和减法，可以使用括号改变优先级。

## 作业要求完成情况

| 要求                 | 完成情况 | 说明             |
| -------------------- | -------- | ---------------- |
| 构造递归下降分析程序 | ✅ 完成  | parser.py 中实现 |
| 输入单词串以"#"结束  | ✅ 完成  | 强制要求 # 结束  |
| 正确输出"acc"        | ✅ 完成  | 语法正确时输出   |
| 错误输出"error"      | ✅ 完成  | 语法错误时输出   |
| 指出错误类型和位置   | ✅ 完成  | 详细的错误信息   |
| 输出整个分析过程     | ✅ 完成  | 完整的步骤记录   |
| 可视化界面           | ✅ 完成  | tkinter 图形界面 |
| 文件读取功能         | ✅ 完成  | 支持从文件加载   |

**完成度**: 100% ✅

## 作者信息

- **课程**: 编译原理 小组作业 3 - 递归下降语法分析
- **作者**: DLPU Computer Science（ISEC）231 邵昱铭 王宝飞 孙智博 肖宇航
- **实现语言**: Python 3
- **GUI 框架**: tkinter

## 参考资料

- 《编译原理》（龙书）
- 递归下降分析方法
- 消除左递归算法
- Python tkinter 官方文档
